name: ci

on:
  workflow_dispatch:
  pull_request:
    paths:
      - 'src/**'
      - 'tests/**'
  push:
    branches: ["*"]
    paths:
      - 'src/**'
      - 'tests/**'

env:
  CONFIGURATION: Release

jobs:

  build_wpfblazor:
    name: Build WpfBlazor
    runs-on: windows-latest
    steps:
      - name: 🤘 Checkout repository
        uses: actions/checkout@v3
      - name: 🔧 Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0.x'
      - name: 🔄 dotnet restore (WpfBlazor only)
        shell: pwsh
        run: |
          dotnet restore `
            src/WpfBlazor/WpfBlazor.csproj
      - name: 🙏 dotnet build (WpfBlazor only)
        shell: pwsh
        run: |
          dotnet build `
            src/WpfBlazor/WpfBlazor.csproj `
            --configuration $env:CONFIGURATION `
            --no-restore

  test:
    name: Run All Tests
    runs-on: windows-latest
    steps:
      - name: 🤘 Checkout repository
        uses: actions/checkout@v3
      - name: 🔧 Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0.x'
      - name: 🔄 dotnet restore (tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet restore `
                $_.FullName
            }
      - name: 🙏 dotnet build (tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet build `
                $_.FullName `
                --configuration $env:CONFIGURATION `
                --no-restore
            }
      - name: 🧪 dotnet test (tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet test `
                $_.FullName `
                --configuration $env:CONFIGURATION `
                --no-build
            }

