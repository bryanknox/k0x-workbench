name: ci
on:
  pull_request:
    paths:
      - 'src/**'
      - 'tests/**'
  push:
    branches: ["*"]
    paths:
      - 'src/**'
      - 'tests/**'

jobs:

  build:
    name: Build and Test

    # WPF applications require Windows for builds.
    runs-on: windows-latest

    env:
      CONFIGURATION: Release

    steps:
      - name: ü§ò Checkout repository
        uses: actions/checkout@v3

      - name: üîß Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '9.0.x'

      - name: üîÑ dotnet restore (src & tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path src,tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet restore \
                $_.FullName
            }

      - name: ‚úì dotnet format (src & tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path src,tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet format whitespace \
                --verify-no-changes \
                --no-restore \
                -v:diag \
                --exclude ~/.nuget \
                $_.FullName
            }
          Get-ChildItem -Path src,tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet format style \
                --verify-no-changes \
                --no-restore \
                -v:diag \
                --exclude ~/.nuget \
                $_.FullName
            }

      - name: üôè dotnet build (src & tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path src,tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet build \
                $_.FullName \
                --configuration $env:CONFIGURATION \
                --no-restore
            }

      - name: üß™ dotnet test (tests only)
        shell: pwsh
        run: |
          Get-ChildItem -Path tests -Recurse -Filter *.csproj |
            ForEach-Object {
              dotnet test \
                $_.FullName \
                --configuration $env:CONFIGURATION \
                --no-build
            }

